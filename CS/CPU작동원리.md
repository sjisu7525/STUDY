
# CPU 작동원리

## | ALU와 제어장치

### ■ ALU
- ALU는 레지스터로부터 피연산자를 받아들이고, 제어장치로부터 제어 신호를 받아들이고 결과값을 레지스터로 내보냄
- ALU는 연산 결과에 대한 부가 정보인 플래그를 플래그 레지스터로 내보냄

### ■ 제어장치
- 제어장치가 받아들이는 정보
  - 클럭 : 컴퓨터의 모든 부품을 일사불란하게 움직일 수 있게 하는 시간 단위
  - 명령어 레지스터로부터 해석할 명령어
  - 플래그 레지스터로부터  플래그
  - 제어 신호
- 내보내는 정보
  - 제어 신호(CPU 내부, 외부)
  
## | 레지스터
- CPU 내부의 작은 임시저장장치
- 프로그램 속 명령어 & 데이터는 실행 전후로 레지스터에 저장


### ■ 레지스터 종류
- 프로그램 카운터 : 메모리에서 가져올 명령어의 주소(메모리에서 읽어 들일 명령어의 주소) : 순차적으로 수행됨
- 명령어 레지스터 : 해석할 명령어 (방금 메모리에서 읽어 들인 명령어)
- 메모리 주소 레지스터 : 메모리의 주소를 저장
- 메모리 버퍼 레지스터 : 메모리와 주고받을 값(데이터와 명령어)

```
✅ 순차적인 흐름이 끊기는 경우
- 특정 메모리 주소로 실행 흐름을 이동하는 명령어 실행 시
- 인터럽트 발생 시
- ETC ...
```

- 플래그 레지스터 : 연산 결과 또는 CPU 상태에 대한 부가적인 정보
- 범용 레지스터 : 다양하고 일반적인 상황에서 자유롭게 사용
- 스택 포인터 : 스택의 꼭대기를 가리키는 레지스터 
  - 스택 주소 지정 방식 : 스택과 스택 포인터를 이용한 주소 지정 방식
- 베이스 레지스터 : 변위 주소 지정 방식에서 사용되는 주소 지정 방식으로 기준 주소를 저장
  - 변위 주소 지정 방식 : 오퍼랜드 필드의 값과 특정 레지스터의 값을 더하여 유효 주소 얻기
    - 상대 주소 지정 방식 : 오퍼랜드 필드의 값과 프로그램 카운터의 값을 더하여 유효 주소 얻기
    - 베이스 레지스터 주소 지정 방식 : 오퍼랜드 필드의 값과 베이스 레지스터의 값을 더하여 유효 주소 얻기

<br>

## | 명령어 사이클과 인터럽트

### ■ 명령어 사이클
- 프로그램 속 명령어들은 일정한 주기가 반복되며 실행이 주기를 명령어 사이클이라고 함

`인출 사이클` : 가장 먼저 CPU로 갖고 와야 한다.

`실행 사이클` : 갖고 왔으면 실행해야 한다.

`간접 사이클` : 메모리 접근이 더 필요한 경우 인출 - 간접 - 실행 사이클을 거쳐 실행된다.

### ■ 인터럽트
- CPU가 주목해야할 때, CPU가 얼른 처리해야 할 다른 작업이 생겼을 때
- 인터럽트 종류 : 동기 인터럽트(예외), 비동기 인터럽트(하드웨어 인터럽트)

`동기 인터럽트(예외)` : CPU가 예기치 못한 상황을 접했을 때 발생

`비동기 인터럽트(하드웨어 인터럽트)` : 주로 입출력장치에 의해 발생, 알림과 같은 역할

### ■ 비동기 인터럽트(하드웨어 인터럽트)
- 알림과 같은 인터럽트
- 입출력 작업 도장에도 효율적으로 명령어를 처리하기 위해 하드웨어 인터럽트 사용 
- 입출력 장치는 CPU에 비해 느리며 인터럽트가 없다면 CPU는 프린트 완료 여부를 확인하기 위해 주기적으로 확인해야 한다.
- 인터럽트가 있다면 입출력 작업 동안 CPU는 다른 일을 할 수 있다.

```
✅ 인터럽트의 처리 순서
1. 입출력장치는 CPU에 인터럽트 요청 신호를 보냅니다. 
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인합니다.
3. CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인합니다.
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업합니다.
5. CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행합니다.
6. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업해 둔 작업을 복구하여 실행을 재개합니다. 

- 인터럽트 요청 신호 : CPU의 작업을 방해하는 인터럽트에 대한 요청
- 인터럽트 플래그 : 인터럽트 요청 신호를 받아들일지 무시할지를 결정하는 비트
- 인터럽트 벡터 : 인터럽트 서비스 루틴의 시작 주소를 포함하는 인터럽트 서비스 루틴의 식별 정보
- 인터럽트 서비스 루틴 : 인터럽터를 처리하는 프로그램
``` 

